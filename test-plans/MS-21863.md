# Test Plan: MS-21863 - SharePoint File Copy Regression

## Issue Details
- **JIRA Issue**: MS-21863
- **Summary**: Copying an existing SharePoint file to a new folder should not return Not Found [3.27 fix]
- **Priority**: Critical (Highest Priority Ticket)
- **Assignee**: sam.walters
- **Status**: Unresolved
- **Created**: September 24, 2025
- **Last Updated**: October 9, 2025

## Problem Description
CAE portal agent is failing when copying existing SharePoint files to newly created folders. The operation worked correctly in version 3.26.501 but fails with "Not found" error in version 3.27.351, indicating a **critical regression**.

### Affected Components
- CAE Portal Agent
- SharePoint File System Integration
- File Copy Operations
- Temp Folder Creation

### Error Details
- **Error Message**: "Not found" 
- **Failed Operation**: Copy existing file to new temporary folder
- **Working Version**: 3.26.501
- **Failing Version**: 3.27.351

## Test Objectives
- **Primary**: Verify SharePoint file copy operations work correctly in latest build
- **Secondary**: Ensure regression is identified and reproducible
- **Tertiary**: Validate fix doesn't break other file operations
- **Regression**: Confirm functionality works as it did in 3.26.501

## Prerequisites

### System Requirements
- CAE Portal Agent (versions 3.26.501 and 3.27.351+ for comparison)
- SharePoint environment with appropriate permissions
- Network connectivity to SharePoint shares
- Test user with read/write permissions on SharePoint directories

### SharePoint Test Environment Setup
- **Source Folder**: `/A` (contains template files)
- **Destination Folder**: `/B` (existing folder)
- **Test File**: `Settings.rmscript` (must exist in Folder A)
- **Temp Folder**: `/B/Temp` (to be created during test)

### Required Permissions
- Read access to source folder (`/A`)
- Write access to destination folder (`/B`)
- Folder creation permissions in destination
- File copy permissions across SharePoint directories

## Test Data
- **Template File**: `Settings.rmscript` (existing file that doesn't change)
- **Source Location**: `/A/Settings.rmscript`
- **Target Location**: `/B/Temp/Settings.rmscript`

## Test Steps

### Test Case 1: Version Comparison Testing
**Objective**: Compare behavior between working and failing versions

1. **Test with Version 3.26.501 (Working Version)**
   - Reset test environment to initial state
   - Confirm Folder `/A` exists and contains `Settings.rmscript`
   - Confirm Folder `/B` exists
   - Confirm Folder `/B/Temp` does NOT exist
   - Use CAE Portal Agent 3.26.501 to create `/B/Temp` folder
   - Use CAE Portal Agent 3.26.501 to copy `/A/Settings.rmscript` to `/B/Temp/Settings.rmscript`
   - **Expected Result**: All operations complete successfully

2. **Test with Version 3.27.351 (Failing Version)**
   - Reset test environment to initial state  
   - Confirm Folder `/A` exists and contains `Settings.rmscript`
   - Confirm Folder `/B` exists
   - Confirm Folder `/B/Temp` does NOT exist
   - Use CAE Portal Agent 3.27.351 to create `/B/Temp` folder
   - Use CAE Portal Agent 3.27.351 to copy `/A/Settings.rmscript` to `/B/Temp/Settings.rmscript`
   - **Expected Result**: Copy operation fails with "Not found" error

3. **Compare Results**
   - Document specific differences between versions
   - Note any changes in error handling or file system interaction
   - **Expected Result**: Clear identification of regression

### Test Case 2: Basic SharePoint File Copy Reproduction
**Objective**: Reproduce the exact failure scenario reported

1. **Verify Initial State**
   - Confirm Folder `/A` exists and contains `Settings.rmscript`
   - Confirm Folder `/B` exists
   - Confirm Folder `/B/Temp` does NOT exist
   - **Expected Result**: Initial folder structure is correct

2. **Create Temporary Folder**
   - Use CAE Portal Agent to create `/B/Temp` folder
   - **Expected Result**: Folder `/B/Temp` is created successfully

3. **Attempt File Copy (Failure Scenario)**
   - Use CAE Portal Agent to copy `/A/Settings.rmscript` to `/B/Temp/Settings.rmscript`
   - **Expected Result in 3.27.351**: ❌ Copy fails with "Not found" error
   - **Expected Result in 3.26.501**: ✅ Copy succeeds without error

4. **Verify Error Details**
   - Capture exact error message and stack trace
   - Document timing of when error occurs
   - **Expected Result**: Error details match reported issue

### Test Case 3: File System Variation Testing
**Objective**: Determine scope of the issue

1. **Test Different File Types**
   - Copy `.txt`, `.json`, `.xml`, `.log` files using same pattern
   - **Expected Result**: Determine if issue is file-type specific

2. **Test Different Folder Structures**
   - Test with nested folders: `/A/SubFolder/file.ext` → `/B/Temp/file.ext`
   - Test with different destination patterns: `/B/Temp2/file.ext`
   - **Expected Result**: Determine if issue is path-specific

3. **Test Existing vs New Folders**
   - Copy to existing folder (skip temp folder creation)
   - Copy to newly created folder (current failing scenario)
   - **Expected Result**: Identify if issue is related to folder creation timing

### Test Case 4: SharePoint-Specific Testing
**Objective**: Validate SharePoint integration aspects

1. **Test SharePoint Permissions**
   - Verify file permissions remain intact after copy attempt
   - Check SharePoint access logs for authentication issues
   - **Expected Result**: Permissions are not the root cause

2. **Test Network Connectivity**
   - Monitor network traffic during copy operation
   - Test with different SharePoint connection methods
   - **Expected Result**: Network issues ruled out as cause

3. **Test SharePoint Version Compatibility**
   - Document SharePoint version and configuration
   - Test against different SharePoint environments if available
   - **Expected Result**: SharePoint compatibility confirmed

### Test Case 5: Workaround Testing
**Objective**: Identify temporary solutions

1. **Manual Copy Test**
   - Manually copy same file using Windows Explorer
   - Use PowerShell copy commands with same paths
   - **Expected Result**: Manual operations succeed, confirming paths are valid

2. **Alternative CAE Operations**
   - Test if other CAE file operations work (move, delete, create)
   - Test copy operations without temp folder creation
   - **Expected Result**: Scope of CAE functionality impact determined

## Post-Fix Validation Tests

### Test Case 6: Fix Verification
**Objective**: Validate fix resolves the issue (once available)

1. **Regression Test**
   - Execute Test Case 1 with fixed version
   - **Expected Result**: Copy operation succeeds without error

2. **Comprehensive File Operations Test**
   - Test all file operations (copy, move, create, delete)
   - Test with various file types and folder structures
   - **Expected Result**: All operations work correctly

3. **Performance Impact Test**
   - Compare operation timing before and after fix
   - **Expected Result**: No significant performance degradation

## Environment Configuration

### Development Environment
- **CAE Portal Agent**: Version 3.27.351+ (failing version)
- **SharePoint**: Production-like configuration
- **Test Data**: Isolated test folders and files

### Staging Environment  
- **CAE Portal Agent**: Version 3.26.501 (working version) for comparison
- **SharePoint**: Mirror of production SharePoint structure
- **Test Data**: Production-representative data

### Production Environment
- **Testing**: Read-only verification only
- **Rollback Plan**: Ready to revert to 3.26.501 if critical

## Success Criteria
1. ✅ Issue is fully reproduced and documented
2. ✅ Root cause is identified through version comparison
3. ✅ Regression scope is clearly defined
4. ✅ Fix resolves issue without introducing new problems
5. ✅ All existing functionality remains intact

## Risk Assessment
- **High Risk**: Production SharePoint operations may be affected
- **Medium Risk**: Other file system operations may have similar issues
- **Low Risk**: Issue is isolated to specific copy scenario

## Notes and Considerations
- **Screenshots**: Issue includes 3 screenshots showing failure
- **Version History**: Critical regression between 3.26.501 and 3.27.351
- **SharePoint Dependencies**: Issue is specific to SharePoint file system
- **Timing**: Issue appears related to temp folder creation and immediate file copy
- **Impact**: Affects CAE portal agent functionality for SharePoint users

## Related Issues
- Monitor for similar SharePoint file operation issues
- Check for other regressions in 3.27.351 build
- Review any SharePoint integration changes between versions

## Test Execution Tracking
- [ ] Test Case 1: Version Comparison
- [ ] Test Case 2: Basic Reproduction  
- [ ] Test Case 3: File System Variations
- [ ] Test Case 4: SharePoint-Specific Testing
- [ ] Test Case 5: Workaround Testing
- [ ] Test Case 6: Fix Verification (pending fix)

**Test Plan Created**: October 9, 2025  
**Created By**: sam.walters  
**Review Status**: Pending Review