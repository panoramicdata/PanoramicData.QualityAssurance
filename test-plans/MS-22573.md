# Test Plan: MS-22573 - MagicSuite CLI: api get command --all-tenants flag

## Issue Information
- **JIRA Issue**: MS-22573
- **Title**: MagicSuite CLI: api get command missing --all-tenants flag for super admin queries
- **Type**: Feature/Enhancement
- **Priority**: TBD
- **Reporter**: TBD

## Description
Feature request to add `--all-tenants` flag to the MagicSuite CLI `api get` command, allowing super admin users to query entities across all tenants instead of just the current tenant.

## Test Environment
- **CLI Version**: 4.1.278+0db90d0a24
- **Environment**: test2 (https://api.test2.magicsuite.net)
- **Test User**: Amy Bond (SuperAdmin credentials required)
- **Test Date**: December 15, 2025

## Prerequisites
- MagicSuite CLI installed and updated to latest version
- Super admin credentials configured
- Access to test2 environment
- Multiple tenants available in the system for testing

## Test Cases

### TC1: Verify --all-tenants Flag Documentation
**Objective**: Confirm the flag is documented in help text

**Steps**:
1. Run: `magicsuite api get tenants --help`
2. Look for `--all-tenants` in the help output

**Expected Result**:
- Flag appears in help text under "SUPER ADMIN" section
- Description indicates it requires super admin credentials
- Example usage is provided

**Actual Result**: ✅ PASS
- Flag documented in SUPER ADMIN section
- Description: "Include entities from all tenants (requires super admin)"
- Example provided: `magicsuite api get tenants --all-tenants --select Id,Name,Code`

---

### TC2: Query Without --all-tenants Flag (Baseline)
**Objective**: Verify default behavior returns only current tenant entities

**Steps**:
1. Verify you're authenticated as super admin: `magicsuite auth status`
2. Run: `magicsuite api get tenants --select Id,Name,Code`
3. Count the number of tenants returned
4. Note the tenant details

**Expected Result**:
- Returns only the current tenant (Panoramic Data)
- Count: 1 tenant
- No entities from other tenants

**Actual Result**: ✅ PASS
```
┌────┬────────────────┬──────┐
│ Id │ Name           │ Code │
├────┼────────────────┼──────┤
│ 1  │ Panoramic Data │ n/a  │
└────┴────────────────┴──────┘
Found 1 Tenant(s)
```

---

### TC3: Query With --all-tenants Flag
**Objective**: Verify flag returns entities from all tenants

**Steps**:
1. Run: `magicsuite api get tenants --all-tenants --select Id,Name,Code`
2. Count the number of tenants returned
3. Verify tenants with different IDs are included

**Expected Result**:
- Returns multiple tenants from across the system
- Count: > 1 tenant
- Different tenant IDs visible

**Actual Result**: ✅ PASS
```
Found 16 Tenant(s) including:
- Id 1: Panoramic Data
- Id 3: Tribal
- Id 99: ExteNet
- Id 108: ANS
- Id 119: R2UT
... (11 more tenants)
```

---

### TC4: Verify Flag Works with Different Entity Types
**Objective**: Confirm --all-tenants works across different entity types

**Steps**:
1. Test with connections (without flag):
   - Run: `magicsuite api get connections --select Id,Name,TenantId --take 5`
   - Verify all TenantId values are the same
2. Test with connections (with flag):
   - Run: `magicsuite api get connections --all-tenants --select Id,Name,TenantId --take 10`
   - Verify TenantId values vary

**Expected Result**:
- Without flag: All connections have same TenantId
- With flag: Connections have different TenantId values

**Actual Result**: ✅ PASS
- Without flag: All 5 connections had TenantId=1
- With flag: 10 connections retrieved with TenantId values of 1 and 3

---

### TC5: Verify Super Admin Requirement (Negative Test)
**Objective**: Confirm flag requires super admin credentials

**Steps**:
1. If possible, authenticate with non-super-admin account
2. Attempt: `magicsuite api get tenants --all-tenants --select Id,Name,Code`

**Expected Result**:
- Command should fail or return error
- Error message should indicate insufficient permissions or super admin requirement

**Actual Result**: ⚠️ NOT TESTED
- Unable to test as only super admin credentials available
- Recommend testing with non-super-admin account in future

---

### TC6: Combine --all-tenants with Other Filters
**Objective**: Verify flag works in combination with other query options

**Steps**:
1. Run: `magicsuite api get connections --all-tenants --filter "Default" --select Id,Name,TenantId`
2. Verify results include connections from multiple tenants that match the filter

**Expected Result**:
- Results filtered by name "Default"
- Results include entities from multiple tenants
- Both filtering and tenant scope work together

**Actual Result**: ⚠️ NOT FULLY TESTED
- Basic combination with --select and --take verified
- Recommend additional testing with --filter and --orderby

---

## Test Summary

### Results Overview
- **Total Test Cases**: 6
- **Passed**: 4
- **Failed**: 0
- **Not Tested**: 2 (negative test case + advanced combinations)

### Test Execution Summary
✅ Feature is working as designed
✅ Documentation is clear and accurate
✅ Works across multiple entity types
✅ Properly scopes queries based on flag presence
⚠️ Negative test (non-super-admin) not performed
⚠️ Advanced filter combinations not fully tested

## Recommendations
1. ✅ **Feature is ready for release** - Core functionality working correctly
2. **Future Testing**: Test with non-super-admin account to verify permission enforcement
3. **Future Testing**: Test complex query combinations (--all-tenants + --filter + --orderby + --expand)
4. **Documentation**: Consider adding note to user documentation about super admin requirement

## Notes
- The flag appears to be already implemented in CLI v4.1.278
- No bugs or issues discovered during testing
- Performance was acceptable with test data set (16 tenants)
- Consider testing performance with larger data sets if applicable

## Test Artifacts
- CLI help output captured
- Query results captured for comparison
- Test environment: test2
- Test data: System tenants and connections

## Sign-off
- **Tested By**: Amy Bond
- **Test Date**: December 15, 2025
- **Status**: ✅ APPROVED FOR RELEASE
- **JIRA Status**: Updated with test results
